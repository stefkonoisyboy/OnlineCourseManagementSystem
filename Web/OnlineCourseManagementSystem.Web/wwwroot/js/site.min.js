function scrollToBottom(){try{var n=document.getElementById("messages");n.scrollTop=n.scrollHeight}catch(t){return}}async function getVideoDevices(){try{let n=await navigator.mediaDevices.enumerateDevices();if(n.every(n=>!n.label)&&await navigator.mediaDevices.getUserMedia({video:!0}),n=await navigator.mediaDevices.enumerateDevices(),n&&n.length){const t=[];return n.filter(n=>n.kind==="videoinput").forEach(n=>{const{deviceId:i,label:r}=n;t.push({deviceId:i,label:r})}),t}}catch(n){console.log(n)}return[]}async function startVideo(n,t){const i=document.querySelector(t);if(i)try{_videoTrack&&_videoTrack.detach().forEach(n=>n.remove());_videoTrack=await Twilio.Video.createLocalVideoTrack({deviceId:n});const t=_videoTrack.attach();i.append(t)}catch(r){console.log(r)}}async function createOrJoinRoom(n,t){try{_activeRoom&&_activeRoom.disconnect();const i=await Twilio.Video.createLocalAudioTrack(),r=[i,_videoTrack];if(_activeRoom=await Twilio.Video.connect(t,{name:n,tracks:r,dominantSpeaker:!0}),_activeRoom){initialize(_activeRoom.participants);_activeRoom.on("disconnected",n=>n.localParticipant.tracks.forEach(n=>detachTrack(n.track))).on("participantConnected",n=>add(n)).on("participantDisconnected",n=>remove(n)).on("dominantSpeakerChanged",n=>loudest(n))}}catch(i){console.error(`Unable to connect to Room: ${i.message}`)}return!!_activeRoom}function initialize(n){_participants=n;_participants&&_participants.forEach(n=>registerParticipantEvents(n))}function add(n){_participants&&n&&(_participants.set(n.sid,n),registerParticipantEvents(n))}function remove(n){_participants&&_participants.has(n.sid)&&_participants.delete(n.sid)}function loudest(n){_dominantSpeaker=n}function registerParticipantEvents(n){if(n){n.tracks.forEach(n=>subscribe(n));n.on("trackPublished",n=>subscribe(n));n.on("trackUnpublished",n=>{n&&n.track&&detachRemoteTrack(n.track)})}}function subscribe(n){if(isMemberDefined(n,"on")){n.on("subscribed",n=>attachTrack(n));n.on("unsubscribed",n=>detachTrack(n))}}function attachTrack(n){if(isMemberDefined(n,"attach")){const t=n.attach();if(t.id=n.sid,"video"===t.tagName.toLowerCase())if(n.name==="screen")document.getElementById("sharedScreen").appendChild(t);else{const i=document.createElement("div");i.id=n.sid;i.classList.add("embed-responsive");i.classList.add("embed-responsive-16by9");const r=document.createElement("div");r.classList.add("embed-responsive-item");r.appendChild(t);i.appendChild(r);document.getElementById("participants").appendChild(i)}else document.getElementById("participants").appendChild(t)}}function detachTrack(n){this.isMemberDefined(n,"detach")&&n.detach().forEach(n=>{if("video"===n.tagName.toLowerCase()){const t=n.parentElement;if(t&&t.id!=="camera"){const n=t.parentElement;n&&n.remove()}}else n.remove()})}function isMemberDefined(n,t){return!!n&&n[t]!==undefined}async function leaveRoom(){try{_activeRoom&&(_activeRoom.disconnect(),_activeRoom=null);_participants&&_participants.clear()}catch(n){console.error(n)}}function muteVideo(){var n=_activeRoom.localParticipant;n.videoTracks.forEach(function(n){n.track.disable()})}function unMuteVideo(){var n=_activeRoom.localParticipant;n.videoTracks.forEach(function(n){n.track.enable()})}function unMuteAudio(){var n=_activeRoom.localParticipant;n.audioTracks.forEach(function(n){n.track.enable()})}function muteAudio(){var n=_activeRoom.localParticipant;n.audioTracks.forEach(function(n){n.track.disable()})}function shareScreenHandler(){screenTrack?(_activeRoom.localParticipant.unpublishTrack(screenTrack),screenTrack.stop(),screenTrack=null):navigator.mediaDevices.getDisplayMedia().then(n=>{screenTrack=new Twilio.Video.LocalVideoTrack(n.getTracks()[0],{name:"screen"}),_activeRoom.localParticipant.publishTrack(screenTrack),screenTrack.mediaStreamTrack.onended=()=>{shareScreenHandler()}}).catch(()=>{alert("Could not share the screen")})}$().ready(function(){$("#show").hover(function(){$("#create-text").show("1000")},function(){$("#create-text").hide("1000")})});let _videoTrack=null,_activeRoom=null,_participants=new Map,_dominantSpeaker=null;window.videoInterop={getVideoDevices,startVideo,createOrJoinRoom,leaveRoom};var screenTrack;